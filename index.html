<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"></noscript>

<link rel="preload" href="experiment-css/experiment.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="experiment-css/experiment.css"></noscript>
<meta http-equiv="X-Content-Type-Options" content="nosniff">
<meta http-equiv="X-Frame-Options" content="DENY">
<meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://kit.fontawesome.com/5c12c7df97.js" crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script type="text/javascript" src="experiment-js/experiment.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

 <title>17 legends</title>

 <link rel="icon" href="experiment-images/favicon.jpg">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Agbalumo&family=Roboto&display=swap" rel="stylesheet">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
 <link rel="stylesheet" href="experiment-css/experiment.css" />
  </head>
  <body>
    <style>
      body.no-scroll {
        overflow: hidden;
      }
    
      @media only screen and (max-width: 768px) {
        .popup {
          width: fit-content;
          max-width: 100%;
        }
    
        .popup-ad img {
          height: 350px;
          width: fit-content;
          max-width: 100%;
        }
    
        .popup-ad {
          height: 350px;
          width: fit-content;
          max-width: 100%;
        }
    
        .p-close-btn {
          position: absolute;
          top: 5px; /* Adjusted for smaller screens */
          right: 5px; /* Adjusted for smaller screens */
          color: #07ec67;
          z-index: 1000;
          cursor: pointer;
          transform: translateZ(0); /* Ensure smooth rendering */
        }
      }
    
      .popup-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(5px);
        -webkit-backdrop-filter: blur(5px);
        display: none;
        z-index: 9998;
      }
    
      .popup-content {
        position: relative;
        width: 100%; /* Ensure it adapts to carousel */
        height: 100%; /* Ensure it adapts to carousel */
        overflow: hidden; /* Prevent any overflow issues */
      }
    
      .p-close-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        font-size: 1.5em;
        color: #07ec67;
        z-index: 1000;
        cursor: pointer;
        transform: translateZ(0); /* Force hardware acceleration for smoother rendering */
      }
    
      .popup-ad {
        width: 600px;
        height: 400px;
      }
    
      .popup {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: transparent;
        padding: 0;
        margin: 0;
        border-radius: 0;
        box-shadow: none;
        z-index: 9999;
        overflow: hidden;
      }
    
      .popup-ad img {
        max-width: 600px;
        max-height: 400px;
      }
    </style>
    
    <div class="popup-overlay">
      <div class="popup">
        <div class="popup-content">
          <span class="p-close-btn">&times;</span>
          <div id="popupCarousel" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-inner">
              <div class="carousel-item active rounded popup-ad">
                <a href="https://youtu.be/dQw4w9WgXcQ?si=CR8gZChdWXQLDdfO" target="_blank">
                  <img src="experiment-images/ad.png" class="d-block w-100" alt="Loading...">
                </a>
              </div>
              <div class="carousel-item rounded popup-ad">
                <a href="https://youtu.be/atgjKEgSqSU?si=7kr0_cBSV3xpDiSV" target="_blank">
                  <img src="experiment-images/favicon.jpg" class="d-block w-100" alt="Loading...">
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
<script>
document.addEventListener("DOMContentLoaded", function () {
  var popupOverlay = document.querySelector('.popup-overlay');
  var popup = document.querySelector('.popup');
  var closeButton = document.querySelector('.p-close-btn');
  var carouselElement = document.querySelector('#popupCarousel');

  // Initialize the Bootstrap carousel
  var carousel = new bootstrap.Carousel(carouselElement, {
    interval: 5000 // Set the interval to 5000 milliseconds (5 seconds)
  });

  function openPopup() {
    popupOverlay.style.display = 'block';
    popup.style.display = 'block';
    document.body.classList.add('no-scroll'); // Add no-scroll class to body
    carousel.cycle(); // Start the carousel
  }

  function closePopup() {
    popupOverlay.style.display = 'none';
    popup.style.display = 'none';
    document.body.classList.remove('no-scroll'); // Remove no-scroll class from body
    carousel.pause(); // Pause the carousel
  }

  // Event listener to close the popup
  closeButton.addEventListener('click', closePopup);

  function checkLoginStatus() {
    const userEmail = localStorage.getItem("userEmail");
    
    // Open popup only if the user is not logged in
    if (!userEmail) {
      setTimeout(function() {
        openPopup();
        localStorage.setItem("popupShown", "true"); // Mark the popup as shown
      }, 15000); // Show popup after 15 seconds
    }
  }

  // Hide the close button during transitions
  carouselElement.addEventListener('slide.bs.carousel', function () {
    closeButton.style.display = 'none';
  });

  // Show the close button after the transition is complete
  carouselElement.addEventListener('slid.bs.carousel', function () {
    closeButton.style.display = 'block';
  });

  // Check login status on page load
  checkLoginStatus();
});
    </script>
    
    
  <div class="container">
    <style>
      .navbar-container {
          position: relative;
      }
      .navbar {
          background-color: rgba(169, 169, 169, 0.5);
          transition: background-color 0.3s ease;
      }
      .navbar.scrolled {
          background-color: rgba(0, 0, 0, 0.9);
      }
      .navbar-brand:hover,
      .navbar-nav .nav-link:hover {
          color: red;
      }
      .navbar-brand:visited,
      .navbar-nav .nav-link:visited {
          color: green;
      }
      .slide-left-view {
          opacity: 0;
          transform: translateX(-100%);
          transition: transform 1s ease, opacity 1s ease;
      }
      .slide-left-view.animated {
          opacity: 1;
          transform: translateX(0);
      }
      .slide-left-view:nth-child(1) {
          transition-delay: 0.1s;
      }
      .slide-left-view:nth-child(2) {
          transition-delay: 0.2s;
      }
      .slide-left-view:nth-child(3) {
          transition-delay: 0.3s;
      }
      .slide-left-view:nth-child(4) {
          transition-delay: 0.4s;
      }
      .slide-left-view:nth-child(5) {
          transition-delay: 0.5s;
      }
      .user-info-overlay {
          position: absolute;
          top: 100%;
          left: 50%;
          transform: translateX(-50%);
          background-color: #000;
          color: #fff;
          padding: 15px;
          border-radius: 5px;
          box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
          z-index: 1;
          width: fit-content;
          opacity: 0;
          visibility: hidden;
          pointer-events: none;
          transition: transform 0.5s ease, opacity 0.5s ease;
      }
      .user-info-container.show-overlay .user-info-overlay {
          transform: translateX(-50%) translateY(10px);
          opacity: 1;
          visibility: visible;
          pointer-events: auto;
      }
      .slide-up-smartphone .user-info-overlay {
          transform: translateX(-50%) translateY(-100%);
          opacity: 1;
          visibility: visible;
      }
      .slide-down-pc .user-info-overlay {
          transform: translateX(-50%) translateY(10px);
          opacity: 1;
          visibility: visible;
      }
      .close-btn {
          position: absolute;
          top: -12px; /* Adjust this value to fine-tune the vertical position */
          right: 3px; /* Adjust this value to fine-tune the horizontal position */
          cursor: pointer;
          font-weight: bold;
          font-size: 1.5em;
          color: red;
      }
  </style>
  
      </head>
      <body>
      
        <div class="custom-video-container">
          <video autoplay loop muted class="custom-background-video">
              <source src="videos/background.mp4" type="video/mp4">
              Your browser does not support the video tag.
          </video>
      </div>
      <div class="overlay"></div> 
      <div class="navbar-container">
          <nav class="navbar navbar-expand-lg navbar fixed-top">
              <div class="container-fluid">
                  <div class="logo-image slide-left-view">
                      <img src="experiment-images/favicon.jpg" class="img-fluid rounded">
                  </div>
                  <a class="navbar-brand slide-left-view" href="index.html">17 Legends</a>
                  <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar" aria-label="Toggle navigation">
                      <span class="navbar-toggler-icon"></span>
                  </button>
                  <div class="sidebar offcanvas offcanvas-start" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel" style="background-color: rgba(0, 0, 0, 0.4);">
                      <div class="offcanvas-header border-bottom">
                          <h5 class="offcanvas-title" id="offcanvasNavbarLabel">Contents</h5>
                          <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                      </div>
                      <div class="offcanvas-body d-flex flex-column flex-lg-row p-4 p-lg-0">
                          <ul class="navbar-nav justify-content align-items-center fs-5 flex-grow-1 pe-3">
                              <li class="nav-item mx-2 slide-left-view">
                                  <a class="nav-link" href="index.html">Home</a>
                              </li>
                              <li class="nav-item mx-2 slide-left-view">
                                  <a class="nav-link" href="1-index.html">About</a>
                              </li>
                          </ul>
                          <div class="d-flex flex-column flex-lg-row justify-content-center align-items-center gap-3">
                              <a href="experiment-login.html" class="text-green slide-left-view" id="login-link"><i class="fas fa-arrow-right-to-bracket"></i> Login</a>
                              <a href="experiment-signup.html" class="rounded-button slide-left-view" id="signup-link"><i class="far fa-user"></i> Sign Up</a>
                              <div class="user-info-container slide-left-view" id="user-info-container" style="display: none;">
                                  <a href="#" class="rounded-button" id="user-info-button"><i class="fas fa-user"></i> User Info</a>
                                  <div class="user-info-overlay">
                                      <span class="close-btn" id="close-btn">&times;</span>
                                      <p><strong>Username:</strong> <span id="username-display"></span></p>
                                      <p><strong>Email:</strong> <span id="email-display"></span></p>
                                  </div>
                              </div>
                              <a href="#" class="rounded-button slide-left-view" id="logout-link" style="display: none;"><i class="fas fa-arrow-right-from-bracket"></i> Logout</a>
                              <a href="#" class="rounded-button slide-left-view" id="delete-account-link" style="display: none;"><i class="fas fa-trash"></i> Delete Account</a>
                          </div>
                      </div>
                  </div>
              </div>
          </nav>
      </div>

<script>
function enhancedSanitize(input) {
    if (typeof input !== 'string') return '';
    
    return input
        // Basic HTML escaping
        .replace(/</g, '&lt;').replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;').replace(/'/g, '&#x27;')
        // Remove script tags and event handlers
        .replace(/javascript:/gi, '')
        .replace(/onclick|onload|onerror|onmouseover/gi, '')
        .replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '')
        // Limit length
        .substring(0, 500);
}
  </script>

<script src="firebase-config.js"></script>
<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js';
import { initializeAppCheck, ReCaptchaV3Provider } from 'https://www.gstatic.com/firebasejs/10.14.0/firebase-app-check.js';
import { getAuth, signInWithEmailAndPassword, sendPasswordResetEmail, signInWithPopup, GoogleAuthProvider, EmailAuthProvider, reauthenticateWithCredential, reauthenticateWithPopup, deleteUser, signOut } from 'https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js';
import { getFirestore, doc, deleteDoc, collection, addDoc, onSnapshot, query,setDoc,updateDoc,getDocs,where, getDoc } from 'https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js';

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();
const db = getFirestore(app);
    initializeAppCheck(app, {
  provider: new ReCaptchaV3Provider('6LdpeVYqAAAAAA2i5yEtBFiVV3cBS9WCAin8LK3w'),
  isTokenAutoRefreshEnabled: true
});

// Update the global Firebase functions
window.firebaseApp = {
    auth: auth,
    db: db,
    collection: collection,
    doc: doc,
    setDoc: setDoc,
    updateDoc: updateDoc,
    addDoc: addDoc,
    getDocs: getDocs,
    getDoc: getDoc, // Add this line
    onSnapshot: onSnapshot,
    query: query,
    where: where
};

// ðŸ”¥ SIMPLE TAMPER PROTECTION (No other changes needed)
(function() {
    const originalGetItem = localStorage.getItem;
    const originalSetItem = localStorage.setItem;
    
    localStorage.getItem = function(key) {
        const value = originalGetItem.call(this, key);
        
        // Only validate userEmail - everything else works normally
        if (key === 'userEmail' && value) {
            const user = auth.currentUser;
            
            // If Firebase user doesn't match localStorage, clear tampered data
            if (!user || user.email !== value) {
                console.warn('Tampered localStorage detected - clearing invalid data');
                this.removeItem('userEmail');
                this.removeItem('popupShown');
                return null;
            }
        }
        
        return value;
    };
    
    console.log("ðŸ”’ Tamper protection activated");
})();

// âœ… SIMPLE FIRESTORE CLEANUP (This works!)
async function checkAndCleanExpiredUsers() {
    const user = auth.currentUser;
    
    if (user && !user.emailVerified) {
        const creationTime = user.metadata.creationTime;
        const accountAge = Date.now() - new Date(creationTime).getTime();
        const maxAge = 10 * 60 * 1000; // 10 minutes
        
        console.log(`â° Checking unverified user: ${Math.round(accountAge/1000)}s old`);
        
        if (accountAge > maxAge) {
            console.log('ðŸš¨ Cleaning up expired unverified user from Firestore');
            await performFirestoreCleanup(user);
        }
    }
}

// âœ… ONLY CLEARS FIRESTORE (No auth deletion attempts)
async function performFirestoreCleanup(user) {
    try {
        // Delete from Firestore users collection
        const userDocRef = doc(db, "users", user.uid);
        await deleteDoc(userDocRef).catch(() => {});
        console.log('ðŸ—‘ï¸ Removed user data from Firestore');
        
        // Delete from Firestore votes collection
        const voteDocRef = doc(db, "votes", user.uid);
        await deleteDoc(voteDocRef).catch(() => {});
        console.log('ðŸ—‘ï¸ Removed vote data from Firestore');
        
        // Sign out user
        await signOut(auth);
        console.log('ðŸ‘‹ Signed out user');
        
        // Clear localStorage
        localStorage.removeItem("userEmail");
        localStorage.removeItem("popupShown");
        
        // Show message and redirect
        alert('Please verify your email within 10 minutes. Your data has been cleared.');
        window.location.href = "index.html";
        
    } catch (error) {
        console.error('Error in Firestore cleanup:', error);
        // Still try to sign out
        await signOut(auth);
        window.location.href = "index.html";
    }
}

// âœ… START THE CLEANUP SYSTEM
// Run check when auth state changes
auth.onAuthStateChanged((user) => {
    if (user) {
        checkAndCleanExpiredUsers();
    }
});

// Run check periodically
setInterval(() => {
    if (auth.currentUser) {
        checkAndCleanExpiredUsers();
    }
}, 60 * 1000); // Check every minute

// Initial check after page load
setTimeout(() => {
    if (auth.currentUser) {
        checkAndCleanExpiredUsers();
    }
}, 3000);

        document.addEventListener("DOMContentLoaded", function () {
            const navbar = document.querySelector(".navbar");
            const elementsToAnimate = document.querySelectorAll('.slide-left-view');
            const loginLink = document.getElementById("login-link");
            const signupLink = document.getElementById("signup-link");
            const logoutLink = document.getElementById("logout-link");
            const userInfoContainer = document.getElementById("user-info-container");
            const userInfoButton = document.getElementById("user-info-button");
            const usernameDisplay = document.getElementById("username-display");
            const emailDisplay = document.getElementById("email-display");
            const closeButton = document.getElementById("close-btn");
            const userInfoOverlay = document.querySelector(".user-info-overlay");
            const deleteAccountLink = document.getElementById("delete-account-link");
            const votingForm = document.getElementById("voting-form");
            const loginCard = document.getElementById("login-card");
// Check user login status
function checkLoginStatus() {
    const userEmail = localStorage.getItem("userEmail");
    if (userEmail) {
        const userName = userEmail.split("@")[0];
        loginLink.style.display = "none";
        signupLink.style.display = "none";
        usernameDisplay.textContent = userName;
        emailDisplay.textContent = userEmail;
        userInfoContainer.style.display = "inline-block";
        logoutLink.style.display = "inline-block";
        deleteAccountLink.style.display = "inline-block";
        votingForm.style.display = "block";
        loginCard.style.display = "none";
        
        // Check for existing vote after a short delay to ensure Firebase is ready
        setTimeout(checkExistingVote, 1000);
    } else {
        loginLink.style.display = "inline-block";
        signupLink.style.display = "inline-block";
        userInfoContainer.style.display = "none";
        logoutLink.style.display = "none";
        deleteAccountLink.style.display = "none";
        votingForm.style.display = "none";
        loginCard.style.display = "block";
    }
}

// Update the checkExistingVote function
async function checkExistingVote() {
    const user = window.firebaseApp.auth.currentUser;
    if (!user) return;

    try {
        const votesQuery = window.firebaseApp.query(
            window.firebaseApp.collection(window.firebaseApp.db, "votes"),
            window.firebaseApp.where("userId", "==", user.uid)
        );
        
        const querySnapshot = await window.firebaseApp.getDocs(votesQuery);
        
        if (!querySnapshot.empty) {
            const existingVote = querySnapshot.docs[0].data();
            // Pre-fill the form with existing vote
            document.getElementById('nameInput').value = existingVote.name || '';
            document.getElementById('favoriteInput').value = existingVote.favoritePlayer || '';
            document.getElementById('write-area').value = existingVote.reason || '';
            
            // Update submit button text
            document.getElementById('submitBtn').textContent = 'Update Vote';
            
            // Show message
            $("#voting-form").prepend(
                "<div class='alert alert-info' role='alert'>You've already voted for " + 
                existingVote.favoritePlayer + ". You can update your vote below.</div>"
            );
        }
    } catch (error) {
        console.error("Error checking existing vote:", error);
    }
}
    
            logoutLink.addEventListener("click", function () {
                signOut(auth).then(() => {
                    localStorage.removeItem("userEmail");
                    localStorage.removeItem("popupShown"); // Reset popupShown to allow popup on next visit
                    checkLoginStatus(); // Update UI after logout
                    window.location.href = "index.html"; // Redirect to login page
                }).catch((error) => {
                    console.error("Error signing out:", error);
                });
            });
    
            // Handle user info button click
            userInfoButton.addEventListener("click", function (event) {
                event.preventDefault();
                userInfoContainer.classList.toggle("show-overlay");
    
                // Toggle slide-up or slide-down animation based on device type
                if (isMobileDevice()) {
                    userInfoOverlay.style.transform = "translateX(-50%) translateY(-100%)";
                } else {
                    userInfoOverlay.style.transform = "translateX(-50%) translateY(10px)";
                }
    
                userInfoOverlay.style.opacity = 1;
                userInfoOverlay.style.visibility = "visible";
                userInfoOverlay.style.pointerEvents = "auto";
            });
    
            // Handle close button click
            closeButton.addEventListener("click", function () {
                userInfoOverlay.style.opacity = 0;
                userInfoOverlay.style.visibility = "hidden";
                userInfoOverlay.style.pointerEvents = "none";
            });
    
            // Function to detect mobile device
            function isMobileDevice() {
                return window.innerWidth <= 768;
            }
    
            // Handle Delete Account button click
            if (deleteAccountLink) {
                deleteAccountLink.addEventListener("click", function (event) {
                    event.preventDefault();
                    const confirmation = confirm("Are you sure you want to delete your account? This action cannot be undone.");
                    if (confirmation) {
                        reauthenticateAndDeleteAccount();
                    }
                });
    
                // Function to reauthenticate and delete account
                function reauthenticateAndDeleteAccount() {
                    const user = auth.currentUser;
    
                    if (user) {
                        const providerId = user.providerData[0].providerId;
    
                        if (providerId === 'password') {
                            // For email/password users
                            const email = user.email;
                            const password = prompt("Please enter your password to delete your account:");
    
                            if (password) {
                                const credential = EmailAuthProvider.credential(email, password);
                                reauthenticateWithCredential(user, credential).then(() => {
                                    deleteUserAndFirestore(user);
                                }).catch(function (error) {
                                    console.error("Re-authentication failed:", error);
                                    alert("Re-authentication failed. Please try again.");
                                });
                            }
                        } else if (providerId === 'google.com') {
                            // For Google users
                            reauthenticateWithPopup(user, provider).then(() => {
                                deleteUserAndFirestore(user);
                            }).catch(function (error) {
                                console.error("Re-authentication failed:", error);
                                alert("Re-authentication failed. Please try again.");
                            });
                        }
                    } else {
                        alert("No user is currently logged in.");
                    }
                }
    
async function deleteUserAndFirestore(user) {
    try {
        const userDocRef = doc(db, "users", user.uid);
        const voteDocRef = doc(db, "votes", user.uid);

        console.log("Starting account deletion process for user:", user.uid);

        // First, try to delete the vote document if it exists
        try {
            // Check if vote exists first using the imported getDoc
            const voteDoc = await getDoc(voteDocRef);
            if (voteDoc.exists()) {
                await deleteDoc(voteDocRef);
                console.log("User vote deleted from Firestore.");
            } else {
                console.log("No vote found to delete - user hadn't voted yet");
            }
        } catch (voteError) {
            // If we can't delete the vote (permission denied or not found), just log and continue
            console.log("Vote deletion issue (may not exist or permission denied):", voteError);
            // Don't throw - continue with user deletion
        }

        // Then delete the user document
        try {
            await deleteDoc(userDocRef);
            console.log("User document deleted from Firestore.");
        } catch (userDocError) {
            console.log("User document deletion issue (may not exist):", userDocError);
            // Continue with account deletion even if user doc doesn't exist
        }

        // Finally delete the Firebase Authentication user
        await deleteUser(user);
        
        alert("Account deleted successfully.");
        localStorage.removeItem("userEmail");
        checkLoginStatus();
        window.location.href = "index.html";
        
    } catch (error) {
        console.error("Error deleting user data:", error);
        if (error.code === 'permission-denied') {
            alert("Permission denied. Please make sure you're logged in and try again.");
        } else if (error.code === 'auth/requires-recent-login') {
            alert("Please log in again to delete your account.");
        } else {
            alert("Error deleting account: " + error.message);
        }
    }
}
            }
            // Run on page load
            checkLoginStatus();
    
            window.addEventListener("scroll", function () {
                if (window.scrollY > 50) {
                    navbar.classList.add("scrolled");
                } else {
                    navbar.classList.remove("scrolled");
                }
            });
    
            const observer = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('animated');
                        observer.unobserve(entry.target);
                    }
                });
            }, {
                threshold: 0.1
            });
    
            elementsToAnimate.forEach(element => {
                observer.observe(element);
            });
        });

// Wikipedia API integration - only player name mappings
const playerWikipediaMap = {
    'Messi': 'Lionel_Messi',
    'Ronaldo': 'Cristiano_Ronaldo',
    'Neymar': 'Neymar',
    'MbappÃ©': 'Kylian_MbappÃ©',
    'Salah': 'Mohamed_Salah',
    'Kane': 'Harry_Kane',
    'SuÃ¡rez': 'Luis_SuÃ¡rez',
    'Ã–zil': 'Mesut_Ã–zil',
    'Hakimi': 'Achraf_Hakimi',
    'Antoine': 'Antoine_Griezmann', 
    'Robert': 'Robert_Lewandowski',
    'Zlatan': 'Zlatan_IbrahimoviÄ‡',
    'Haaland': 'Erling_Haaland',
    'ModriÄ‡': 'Luka_ModriÄ‡',
    'David': 'David_Beckham',
    'Heung': 'Son_Heung-min',
    'Virgil': 'Virgil_van_Dijk'
};

async function fetchPlayerInfo(playerName) {
    const wikiPageName = playerWikipediaMap[playerName];
    
    if (!wikiPageName) {
        console.log(`No Wikipedia mapping for: ${playerName}`);
        return null;
    }

    try {
        // Use Wikipedia's action API which is more CORS-friendly
        const response = await fetch(
            `https://en.wikipedia.org/w/api.php?action=query&format=json&prop=extracts|pageimages&exintro=true&explaintext=true&pithumbsize=300&titles=${encodeURIComponent(wikiPageName)}&origin=*`
        );
        
        if (!response.ok) {
            throw new Error('Player not found on Wikipedia');
        }
        
        const data = await response.json();
        const pages = data.query.pages;
        const pageId = Object.keys(pages)[0];
        const pageData = pages[pageId];
        
        if (pageData.missing) {
            throw new Error('Player page not found');
        }
        
        const description = pageData.extract || 'No description available.';
        const image = pageData.thumbnail?.source;
        
        // Extract birth info from the description
        const bornInfo = extractBornFromText(description);
        console.log(`Born info for ${playerName}:`, bornInfo);
        
        return {
            description: description,
            image: image,
            lastUpdated: new Date().toLocaleDateString(),
            ...bornInfo
        };
    } catch (error) {
        console.log(`Wikipedia API error for ${playerName}:`, error);
        return {
            description: `Could not load information for ${playerName}.`,
            lastUpdated: new Date().toLocaleDateString(),
            birthInfo: '',
            age: ''
        };
    }
}

function extractBornFromText(text) {
    let birthInfo = "";
    let age = "";

    if (!text) return { birthInfo, age };

    const datePatterns = [
        /born[^0-9]{0,10}(\d{1,2}\s+\w+\s+\d{4})/i,
        /born[^0-9]{0,10}(\w+\s+\d{1,2},\s+\d{4})/i,
        /born[^0-9]{0,10}(\d{4}-\d{1,2}-\d{1,2})/i,
        /born on[^0-9]{0,10}(\d{1,2}\s+\w+\s+\d{4})/i,
        /\(born\s+(\d{1,2}\s+\w+\s+\d{4})/i,
        /\(born\s+(\w+\s+\d{1,2},\s+\d{4})/i,
        /born[^0-9]+(19|20)\d{2}/i
    ];

    for (const pattern of datePatterns) {
        const match = text.match(pattern);
        if (match) {
            birthInfo = match[1] || match[0];
            break;
        }
    }

    // If we extracted something â†’ calculate age
    if (birthInfo !== "") {
        age = calculateAgeFromText(birthInfo);
    }

    return { birthInfo, age };
}


function calculateAgeFromText(birthText) {
    // Extract full date (day + month + year)
    const fullDateMatch = birthText.match(/(\d{1,2}\s+\w+\s+\d{4})|(\w+\s+\d{1,2},\s+\d{4})|(\d{4}-\d{1,2}-\d{1,2})/);

    if (!fullDateMatch) return ""; // Can't calculate properly

    let birthDateStr = fullDateMatch[0];
    let birthDate;

    // Try parsing multiple formats
    if (birthDateStr.includes("-")) {
        // YYYY-MM-DD
        birthDate = new Date(birthDateStr);
    } else {
        // Formats like "24 June 1987" or "June 24, 1987"
        birthDate = new Date(Date.parse(birthDateStr));
    }

    if (isNaN(birthDate)) return "";

    const today = new Date();
    let age = today.getFullYear() - birthDate.getFullYear();

    // Check if birthday has NOT occurred yet this year
    const thisYearsBirthday = new Date(today.getFullYear(), birthDate.getMonth(), birthDate.getDate());

    if (today < thisYearsBirthday) {
        age--; // Birthday not yet reached
    }

    return age.toString();
}


// Function to extract first 3 complete sentences
function getFirstThreeSentences(text) {
    if (!text) return '';
    
    // Split by sentence endings (. ! ?) but avoid splitting on abbreviations
    const sentences = text.match(/[^.!?]+[.!?]+/g) || [text];
    
    // Take first 3 sentences
    const firstThree = sentences.slice(0, 3);
    
    // Join them back together
    return firstThree.join(' ').trim();
}

// Update player info with Wikipedia data
async function updatePlayerProfile(playerElement, playerName) {
    const contentOverlay = playerElement.querySelector('.content-overlay');
    const existingText = contentOverlay.querySelector('p');
    
    if (existingText && !contentOverlay.querySelector('.wiki-update')) {
        const loadingDiv = document.createElement('div');
        loadingDiv.className = 'wiki-loading';
        loadingDiv.innerHTML = `<small style="color: #07ec67;">ðŸ”„ Loading Wikipedia info...</small>`;
        existingText.parentNode.insertBefore(loadingDiv, existingText.nextSibling);
        
        let wikiData;
        
        try {
            wikiData = await fetchPlayerInfo(playerName);
        } catch (error) {
            console.log('Failed to fetch Wikipedia data:', error);
            wikiData = {
                description: `Could not load information for ${playerName}.`,
                lastUpdated: new Date().toLocaleDateString(),
                birthInfo: '',
                age: ''
            };
        }
        
        // Remove loading indicator
        loadingDiv.remove();
        
        const wikiInfo = document.createElement('div');
        wikiInfo.className = 'wiki-update';
        
        let infoHTML = '';
        
        if (wikiData.description) {
            // Get first 3 complete sentences
            const threeSentences = getFirstThreeSentences(wikiData.description);
            infoHTML += `<p class="wiki-description"><em>${threeSentences}</em></p>`;
        }
        
        // Add born information if available
        if (wikiData.birthInfo && wikiData.birthInfo !== '') {
            const ageText = wikiData.age ? ` (age ${wikiData.age} years)` : '';
            infoHTML += `<p><strong><u>Born:</u></strong> ${wikiData.birthInfo}${ageText}</p>`;
        } else {
            infoHTML += `<p><small style="color: #ff6b6b;">Born information not available</small></p>`;
        }
        
        // Add timestamp
        infoHTML += `<small style="color: #07ec67; font-size: 0.8em;">
            ðŸ“š Info from Wikipedia â€¢ Updated: ${wikiData.lastUpdated}
        </small>`;
        
        wikiInfo.innerHTML = infoHTML;
        existingText.parentNode.insertBefore(wikiInfo, existingText.nextSibling);
    }
}

// Initialize Wikipedia updates when tab is opened
document.addEventListener('DOMContentLoaded', function() {
    // Wait a bit for page to fully load
    setTimeout(() => {
        const tabPanes = document.querySelectorAll('.tab-pane');
        
        tabPanes.forEach(tabPane => {
            const tabButton = document.querySelector(`[data-bs-target="#${tabPane.id}"]`);
            const playerName = tabButton.textContent.trim();
            
            // Update when tab is shown
            tabButton.addEventListener('shown.bs.tab', function() {
                // Only load if not already loaded
                if (!tabPane.querySelector('.wiki-update') && !tabPane.querySelector('.wiki-loading')) {
                    updatePlayerProfile(tabPane, playerName);
                }
            });
        });
        
        // Update first tab on page load
        const firstTab = document.querySelector('.tab-pane.active');
        const firstPlayer = document.querySelector('.nav-link.active').textContent.trim();
        if (firstTab && !firstTab.querySelector('.wiki-update')) {
            updatePlayerProfile(firstTab, firstPlayer);
        }
    }, 100);
});

// Add CSS styles
const style = document.createElement('style');
style.textContent = `
    .wiki-update {
        margin-top: 10px;
        padding: 10px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 5px;
        border-left: 3px solid #07ec67;
    }
    
    .wiki-description {
        line-height: 1.4;
        margin-bottom: 8px;
    }
    
    .wiki-loading {
        text-align: center;
        padding: 10px;
        font-style: italic;
    }
    
    .wiki-error {
        text-align: center;
        padding: 10px;
        color: #ff6b6b;
        background: rgba(255, 107, 107, 0.1);
        border-radius: 5px;
    }
`;
document.head.appendChild(style);

        // Periodic check for email verification
function checkEmailVerifiedPeriodically() {
    const user = auth.currentUser;
    
    if (!user) return;

    const intervalId = setInterval(async () => {
        try {
            await user.reload(); // Refresh user data
            if (user.emailVerified) {
                clearInterval(intervalId); // Stop the interval

                // Update Firestore to set emailVerified to true
                await setDoc(doc(db, "users", user.uid), { 
                    email: user.email, 
                    emailVerified: true 
                }, { merge: true });

                // Save email to local storage and redirect
                localStorage.setItem("userEmail", user.email);
                window.location.href = "index.html";
            }
        } catch (error) {
            console.error("Error checking email verification:", error);
            clearInterval(intervalId);
        }
    }, 3000); // Check every 3 seconds
}

// Automatically check for email verification
async function autoCheckEmailVerification() {
    const user = auth.currentUser;
    if (user) {
        try {
            await user.reload();
            if (!user.emailVerified) {
                console.log("User not verified, starting periodic check");
                checkEmailVerifiedPeriodically();
            } else {
                console.log("User already verified, redirecting");
                localStorage.setItem("userEmail", user.email);
                window.location.href = "index.html";
            }
        } catch (error) {
            console.error("Error in auto check:", error);
        }
    }
}

// Use Firebase auth state observer instead of DOMContentLoaded
auth.onAuthStateChanged((user) => {
    if (user && !user.emailVerified) {
        console.log("Auth state changed - unverified user detected");
        autoCheckEmailVerification();
    }
});
    </script>
                 
  <style>
    /* Set a fixed height for carousel items */
    #carouselExampleSlides .carousel-item {
      height: 550px; /* Fixed height for carousel items */
    }

    /* Ensure images maintain aspect ratio and fit within the fixed height */
    #carouselExampleSlides .carousel-item img {
      height: 100%;
      width: 100%; /* Maintain aspect ratio */
    }

    /* Ensure the carousel is responsive */
    @media (max-width: 768px) {
      #carouselExampleSlides .carousel-item {
        height: 550px; /* Allow items to adjust height based on content on smaller screens */
      }
      #carouselExampleSlides .carousel-item img {
        height: 100%;
        width: 100%; /* Ensure the image doesn't exceed the height of its parent carousel-item */

      }
    }
  </style>
      <br><br><br><br>
      <div id="carouselExampleSlides" class="carousel slide" data-bs-ride="carousel" style="min-height: 500px;">
        <div class="carousel-inner">
          <div class="carousel-item active">
            <img src="experiment-slides/3.jpg" class="d-block w-100 rounded" alt="Loading...">
          </div>
          <div class="carousel-item">
            <img src="experiment-slides/5.jpg" class="d-block w-100 rounded" alt="Loading...">
          </div>
          <div class="carousel-item">
            <img src="experiment-slides/9.jpeg" class="d-block w-100 rounded" alt="Loading...">
          </div>
          <div class="carousel-item">
            <img src="experiment-slides/10.jpeg" class="d-block w-100 rounded" alt="Loading...">
          </div>
          <div class="carousel-item">
            <img src="experiment-slides/11.jpeg" class="d-block w-100 rounded" alt="Loading...">
          </div>
          <div class="carousel-item">
            <img src="experiment-slides/12.jpeg" class="d-block w-100 rounded" alt="Loading...">
          </div>
          <div class="carousel-item">
            <img src="experiment-slides/13.jpeg" class="d-block w-100 rounded" alt="Loading...">
          </div>
          <div class="carousel-item">
            <img src="experiment-slides/14.jpeg" class="d-block w-100 rounded" alt="Loading...">
          </div>
          <div class="carousel-item">
            <img src="experiment-slides/15.jpeg" class="d-block w-100 rounded" alt="Loading...">
          </div>
          <div class="carousel-item">
            <img src="experiment-slides/16.jpeg" class="d-block w-100 rounded" alt="Loading...">
          </div>
          <div class="carousel-item">
            <img src="experiment-slides/17.jpeg" class="d-block w-100 rounded" alt="Loading...">
          </div>
          <div class="carousel-item">
            <img src="experiment-slides/18.jpeg" class="d-block w-100 rounded" alt="Loading...">
          </div>
          <div class="carousel-item">
            <img src="experiment-slides/19.jpeg" class="d-block w-100 rounded" alt="Loading...">
          </div>
          <div class="carousel-item">
            <img src="experiment-slides/21.jpeg" class="d-block w-100 rounded" alt="Loading...">
          </div>
          <div class="carousel-item">
            <img src="experiment-slides/23.jpeg" class="d-block w-100 rounded" alt="Loading...">
          </div>
          <div class="carousel-item">
            <img src="experiment-slides/24.jpeg" class="d-block w-100 rounded" alt="Loading...">
          </div>
          <div class="carousel-item">
            <img src="experiment-slides/25.jpeg" class="d-block w-100 rounded" alt="Loading...">
          </div>
        </div>
      </div>
      <br>
      <style>
#pills {
    height: 550px; /* Fixed height for the pills container */
    overflow-y: auto; /* Allow vertical scrolling if content exceeds height */
    overflow-x: hidden; /* Hide horizontal scrollbar */
    width: fit-content; /* Adjust width to fit content */
    z-index: 1;
}

.tab-content {
    position: relative; /* Ensure it can contain the absolutely positioned video container */
    width: 100%; /* Expand to fill parent width */
    max-height: 550px; /* Maximum height for the tab content */
    background-color: #222222; /* Dark background color */
    overflow-y: auto; /* Enable vertical scrolling if content exceeds height */
    overflow-x: hidden; /* Hide horizontal scrollbar */
}

.tab-pane {
    position: relative;
    z-index: 1;
    padding: 5px;
    color: #fff;
    min-height: 550px; /* Minimum height for tab pane */
    display: flex;
    flex-direction: column;
    overflow: hidden; /* Hide overflow to ensure proper stacking */
}

.tab-pane img {
    width: 169px;
    height: 169px;
}

.video-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    z-index: -1;
}

video.background-video {
    width: 100%;
    height: 100%;
    object-fit: fill; /* Stretch video to cover the entire container */
    filter: blur(10px); /* Apply blur effect to the video */
}

.content-overlay {
    position: relative;
    z-index: 2; /* Ensure content overlay is above the video */
    background-color: rgba(0, 0, 0, 0.3); /* Adjust overlay background */
    padding: 5px;
    border-radius: 17px; /* Add some rounded corners */
}

@media (max-width: 768px) {
    .tab-content {
        height: 550px; /* Allow tab content to expand based on content */
        max-height: none; /* Remove maximum height restriction */
    }

    .tab-pane {
        min-height: auto; /* Allow tab pane to adjust height based on content */
    }

    video.background-video {
        object-fit: fill; /* Stretch the video to cover the entire container */
        filter: blur(10px); /* Apply blur effect to the video */
    }
}
    </style>
      <div class="d-flex align-items-start">
        <div id="pills" class="container-fluid">
        <div class="nav flex-column nav-pills me-3 slide-in-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
          <button class="nav-link active" id="v-pills-messi-tab" data-bs-toggle="pill" data-bs-target="#v-pills-messi" type="button" role="tab" aria-controls="v-pills-messi" aria-selected="true">Messi</button>
          <button class="nav-link" id="v-pills-ronaldo-tab" data-bs-toggle="pill" data-bs-target="#v-pills-ronaldo" type="button" role="tab" aria-controls="v-pills-ronaldo" aria-selected="false">Ronaldo</button>
          <button class="nav-link" id="v-pills-neymar-tab" data-bs-toggle="pill" data-bs-target="#v-pills-neymar" type="button" role="tab" aria-controls="v-pills-neymar" aria-selected="false">Neymar</button>
          <button class="nav-link" id="v-pills-mbappÃ©-tab" data-bs-toggle="pill" data-bs-target="#v-pills-mbappÃ©" type="button" role="tab" aria-controls="v-pills-mbappÃ©" aria-selected="false">MbappÃ©</button>
          <button class="nav-link" id="v-pills-salah-tab" data-bs-toggle="pill" data-bs-target="#v-pills-salah" type="button" role="tab" aria-controls="v-pills-salah" aria-selected="false">Salah</button>
         <button class="nav-link" id="v-pills-kane-tab" data-bs-toggle="pill" data-bs-target="#v-pills-kane" type="button" role="tab" aria-controls="v-pills-kane" aria-selected="false">Kane</button>
         <button class="nav-link" id="v-pills-suÃ¡rez-tab" data-bs-toggle="pill" data-bs-target="#v-pills-suÃ¡rez" type="button" role="tab" aria-controls="v-pills-suÃ¡rez" aria-selected="false">SuÃ¡rez</button>
         <button class="nav-link" id="v-pills-Ã–zil-tab" data-bs-toggle="pill" data-bs-target="#v-pills-Ã–zil" type="button" role="tab" aria-controls="v-pills-Ã–zil" aria-selected="false">Ã–zil</button>
         <button class="nav-link" id="v-pills-hakimi-tab" data-bs-toggle="pill" data-bs-target="#v-pills-hakimi" type="button" role="tab" aria-controls="v-pills-hakimi" aria-selected="false">Hakimi</button>
         <button class="nav-link" id="v-pills-antoine-tab" data-bs-toggle="pill" data-bs-target="#v-pills-antoine" type="button" role="tab" aria-controls="v-pills-antoine" aria-selected="false">Antoine</button>
         <button class="nav-link" id="v-pills-robert-tab" data-bs-toggle="pill" data-bs-target="#v-pills-robert" type="button" role="tab" aria-controls="v-pills-robert" aria-selected="false">Robert</button>
         <button class="nav-link" id="v-pills-zlatan-tab" data-bs-toggle="pill" data-bs-target="#v-pills-zlatan" type="button" role="tab" aria-controls="v-pills-zlatan" aria-selected="false">Zlatan</button>
         <button class="nav-link" id="v-pills-haaland-tab" data-bs-toggle="pill" data-bs-target="#v-pills-haaland" type="button" role="tab" aria-controls="v-pills-haaland" aria-selected="false">Haaland</button>
         <button class="nav-link" id="v-pills-modriÄ‡-tab" data-bs-toggle="pill" data-bs-target="#v-pills-modriÄ‡" type="button" role="tab" aria-controls="v-pills-modriÄ‡" aria-selected="false">ModriÄ‡</button>
         <button class="nav-link" id="v-pills-david-tab" data-bs-toggle="pill" data-bs-target="#v-pills-david" type="button" role="tab" aria-controls="v-pills-david" aria-selected="false">David</button>
         <button class="nav-link" id="v-pills-heung-tab" data-bs-toggle="pill" data-bs-target="#v-pills-heung" type="button" role="tab" aria-controls="v-pills-heung" aria-selected="false">Heung</button>
         <button class="nav-link" id="v-pills-virgil-tab" data-bs-toggle="pill" data-bs-target="#v-pills-virgil" type="button" role="tab" aria-controls="v-pills-virgil" aria-selected="false">Virgil</button>               
        </div>
        </div>
<div class="tab-content slide-in-tab-content" id="v-pills-tabContent">
                <div class="tab-pane fade show active rounded" id="v-pills-messi" role="tabpanel" aria-labelledby="v-pills-messi-tab" tabindex="0">  <img src="experiment-images/1.jpeg" class="rounded" alt="Loading..." />
                  <div class="video-container">
                    <video autoplay loop muted class="background-video">
                        <source src="videos/messi.mp4" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                </div>
                  <div class="content-overlay">
                    <p></p>
                  <p><strong><u>Team:</u></strong> Inter Miami CF<br><strong><u>National Team:</u></strong> Argentina</p>
      
                  <ol>
                  <li>Barcelona C</li>
                  <li>Barcelona B</li>
                  <li>Barcelona</li>
                  <li>Paris Saint-Germain</li>
                  <li>Inter Miami CF</li>
                  </ol>
      
                    <a target="_blank" href="https://en.wikipedia.org/wiki/Lionel_Messi">Learn more about Messi</a></div></div>
                <div class="tab-pane fade rounded" id="v-pills-ronaldo" role="tabpanel" aria-labelledby="v-pills-ronaldo-tab" tabindex="0">  <img src="experiment-images/2.jpeg" class="rounded" alt="Loading..." />
                  <div class="video-container">
                    <video autoplay loop muted class="background-video">
                        <source src="videos/ronaldo.mp4" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                </div>
                <div class="content-overlay">
                  <p></p>
                  <p><strong><u>Team:</u></strong> Al-Nassr FC<br><strong><u>National Team:</u></strong> Portugal</p>
      
                      <ol>
                      <li>Sporting Clube de Portugal B</li>
                      <li>Sporting Clube de Portugal</li>
                      <li>Manchestar United</li>
                      <li>Real Madrid</li>
                      <li>Juventus</li>
                      <li>Manchestar United</li>
                      <li>Al Nassr</li>
                      </ol>
      
                      <a target="_blank" href="https://en.wikipedia.org/wiki/Cristiano_Ronaldo">Learn more about Ronaldo</a></div></div>
                <div class="tab-pane fade rounded" id="v-pills-neymar" role="tabpanel" aria-labelledby="v-pills-neymar-tab" tabindex="0"><img src="experiment-images/9.jpeg" class="rounded" alt="Loading..." />
                  <div class="video-container">
                    <video autoplay loop muted class="background-video">
                        <source src="videos/neymar.mp4" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                </div>
                <div class="content-overlay">
                  <p></p>
                  <p><strong><u>Team:</u></strong> Al Hilal SFC<br><strong><u>National Team:</u></strong> Brazil</p>
      
                <ol>
                <li>Santos Futebol Clube</li>
                <li>Futbol Club Barcelona</li>
                <li>Paris Saint-Germain Football Club</li>
                <li>Al Hilal Saudi Football Club</li>
                </ol>
      
                <a target="_blank" href="https://en.wikipedia.org/wiki/Neymar">Learn more about Neymar</a></div></div>
                <div class="tab-pane fade rounded" id="v-pills-mbappÃ©" role="tabpanel" aria-labelledby="v-pills-mbappÃ©-tab" tabindex="0"><img src="experiment-images/10.jpeg" class="rounded" alt="Loading..." />
                  <div class="video-container">
                    <video autoplay loop muted class="background-video">
                        <source src="videos/mbappe.mp4" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                </div>
                <div class="content-overlay">
                  <p></p>
                  <p><strong><u>Team:</u></strong> Paris Saint-Germain F.C.<br><strong><u>National Team:</u></strong> France</p>
                  <ol>
                  <li>Monaco II</li>
                  <li>Monaco</li>
                  <li>Paris Saint-Germain (loan)</li>
                  <li>Paris Saint-Germain</li>
                  <li>Real Madrid</li>
                  </ol><a target="_blank" href="https://en.wikipedia.org/wiki/Kylian_MbappÃ©">Learn more about MbappÃ©</a></div></div>
                  <div class="tab-pane fade rounded" id="v-pills-salah" role="tabpanel" aria-labelledby="v-pills-salah-tab" tabindex="0">  <img src="experiment-images/12.jpeg" class="rounded" alt="Loading..." />
                    <div class="video-container">
                      <video autoplay loop muted class="background-video">
                          <source src="videos/salah.mp4" type="video/mp4">
                          Your browser does not support the video tag.
                      </video>
                  </div>
                  <div class="content-overlay">
                    <p></p>
                  <p><strong><u>Team:</u></strong> Liverpool F.C.<br><strong><u>National Team:</u></strong> Egypt</p>
        
                    <ol>
                    <li>Al Mokawloon Al Arab</li>
                    <li>Basel</li>
                    <li>Chelsea</li>
                    <li>Fiorentina (loan)</li>
                    <li>Roma (loan)</li>
                    <li>Roma</li>
                    <li>Liverpool</li>
                    </ol>
        
                    <a target="_blank" href="https://en.wikipedia.org/wiki/Mohamed_Salah">Learn more about Salah</a></div></div>
                  <div class="tab-pane fade rounded" id="v-pills-kane" role="tabpanel" aria-labelledby="v-pills-kane-tab" tabindex="0">  <img src="experiment-images/11.jpeg" class="rounded" alt="Loading..." />
                    <div class="video-container">
                      <video autoplay loop muted class="background-video">
                          <source src="videos/kane.mp4" type="video/mp4">
                          Your browser does not support the video tag.
                      </video>
                      </div>
                      <div class="content-overlay">
                        <p></p>                    
                      <p><strong><u>Team:</u></strong> FC Bayern Munich<br><strong><u>National Team:</u></strong> England</p>
        
                    <ol>
                    <li>Tottenham Hotspur</li>
                    <li>Leyton Orient (loan)</li>
                    <li>Millwall (loan)</li>
                    <li>Norwich City (loan)</li>
                    <li>Leicester City (loan)</li>
                    <li>Bayern Munich</li>
                    </ol>
        
                    <a target="_blank" href="https://en.wikipedia.org/wiki/Harry_Kane">Learn more about Kane</a></div></div>
                  <div class="tab-pane fade rounded" id="v-pills-suÃ¡rez" role="tabpanel" aria-labelledby="v-pills-suÃ¡rez-tab" tabindex="0">  <img src="experiment-images/13.jpeg" class="rounded" alt="Loading..." />
                    
                    <div class="video-container">
                      <video autoplay loop muted class="background-video">
                          <source src="videos/suarez.mp4" type="video/mp4">
                          Your browser does not support the video tag.
                      </video>
                  </div>
                  <div class="content-overlay">
                    <p></p>
                  <p><strong><u>Team:</u></strong> Inter Miami<br><strong><u>National Team:</u></strong> Uruguay</p>
        
                    <ol>
                    <li>Nacional</li>
                    <li>Groningen</li>
                    <li>Ajax</li>
                    <li>Liverpool</li>
                    <li>Barcelona</li>
                    <li>AtlÃ©tico Madrid</li>
                    <li>Nacional</li>
                    <li>GrÃªmio</li>
                    <li>Inter Miami</li>
                    </ol>
        
                    <a target="_blank" href="https://en.wikipedia.org/wiki/Luis_SuÃ¡rez">Learn more about SuÃ¡rez</a></div></div>
                  <div class="tab-pane fade rounded" id="v-pills-Ã–zil" role="tabpanel" aria-labelledby="v-pills-Ã–zil-tab" tabindex="0">  <img src="experiment-images/14.jpeg" class="rounded" alt="Loading..." />
                    <div class="video-container">
                      <video autoplay loop muted class="background-video">
                          <source src="videos/ozil.mp4" type="video/mp4">
                          Your browser does not support the video tag.
                      </video>
                  </div>
                  <div class="content-overlay">
                    <p></p>
                    <p><strong><u>Team:</u></strong> Ä°stanbul BaÅŸakÅŸehir<br><strong><u>National Team:</u></strong> Germany</p><ol>
                      <li>Schalke 04 II</li>
                      <li>Schalke 04</li>
                      <li>Werder Bremen</li>
                      <li>Real Madrid</li>
                      <li>Arsenal</li>
                      <li>FenerbahÃ§e</li>
                      <li>Ä°stanbul BaÅŸakÅŸehir</li>
                      </ol>
          
                      <a target="_blank" href="https://en.wikipedia.org/wiki/Mesut_Ã–zil">Learn more about Ã–zil</a></div></div>
                    <div class="tab-pane fade rounded" id="v-pills-hakimi" role="tabpanel" aria-labelledby="v-pills-hakimi-tab" tabindex="0">  <img src="experiment-images/15.jpeg" class="rounded" alt="Loading..." />
                      <div class="video-container">
                        <video autoplay loop muted class="background-video">
                            <source src="videos/hakimi.mp4" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                    </div>
                    <div class="content-overlay">
                      <p></p>
                    <p></strong> Paris Saint-Germain F.C.<br><strong><u>National Team:</u></strong> Morocco</p>
          
                      <ol>
                      <li>Real Madrid Castilla</li>
                      <li>Real Madrid</li>
                      <li>Borussia Dortmund (loan)</li>
                      <li>Inter Milan</li>
                      <li>Paris Saint-Germain</li>
                      </ol>
          
                      <a target="_blank" href="https://en.wikipedia.org/wiki/Achraf_Hakimi">Learn more about Hakimi</a></div></div>
                    <div class="tab-pane fade rounded" id="v-pills-antoine" role="tabpanel" aria-labelledby="v-pills-antoine-tab" tabindex="0"><img src="experiment-images/16.jpeg" class="rounded" alt="Loading..." />
                      <div class="video-container">
                        <video autoplay loop muted class="background-video">
                            <source src="videos/griezmann.mp4" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                    </div>
                    <div class="content-overlay">
                      <p></p>
                      <p><strong><u>Team:</u></strong> AtlÃ©tico de Madrid<br><strong><u>National Team:</u></strong> France</p>
          
                      <ol>
                      <li>Real Sociedad</li>
                      <li>AtlÃ©tico Madrid</li>
                      <li>Barcelona</li>
                      <li>AtlÃ©tico Madrid (loan)</li>
                      <li>AtlÃ©tico Madrid</li>
                      </ol>
                      <a target="_blank" href="https://en.wikipedia.org/wiki/Antoine_Griezmann">Learn more about Griezmann</a></div></div>
                    <div class="tab-pane fade rounded" id="v-pills-robert" role="tabpanel" aria-labelledby="v-pills-robert-tab" tabindex="0">  <img src="experiment-images/17.jpeg" class="rounded" alt="Loading..." />
                      <div class="video-container">
                        <video autoplay loop muted class="background-video">
                            <source src="videos/lewandowski.mp4" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                    </div>
                    <div class="content-overlay">
                      <p></p>
                      <p><strong><u>Team:</u></strong> FC Barcelona<br><strong><u>National Team:</u></strong> Poland</p>
          
                      <ol>
                      <li>Delta Warsaw</li>
                      <li>Legia Warsaw II</li>
                      <li>Znicz II PruszkÃ³w</li>
                      <li>Znicz PruszkÃ³w</li>
                      <li>Lech PoznaÅ„</li>
                      <li>Borussia Dortmund</li>
                      <li>Bayern Munich</li>
                      <li>Barcelona</li>
                      </ol>
          
                      <a target="_blank" href="https://en.wikipedia.org/wiki/Robert_Lewandowski">Learn more about Lewandowski</a></div></div>
                    <div class="tab-pane fade rounded" id="v-pills-zlatan" role="tabpanel" aria-labelledby="v-pills-zlatan-tab" tabindex="0">  <img src="experiment-images/18.jpeg" class="rounded" alt="Loading..." />
                      <div class="video-container">
                        <video autoplay loop muted class="background-video">
                            <source src="videos/zlatan.mp4" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                    </div>
                    <div class="content-overlay">
                      <p></p>  
                    <p><strong><u>Team:</u></strong> AC Milan<br><strong><u>National Team:</u></strong> Sweden</p><ol>
                        <li>MalmÃ¶ FF</li>
                        <li>Ajax</li>
                        <li>Juventus</li>
                        <li>Inter Milan</li>
                        <li>Barcelona</li>
                        <li>AC Milan (loan)</li>
                        <li>AC Milan</li>
                        <li>Paris Saint-Germain</li>
                        <li>Manchester United</li>
                        <li>LA Galaxy</li>
                        <li>AC Milan</li>
                        </ol>
            
                        <a target="_blank" href="https://en.wikipedia.org/wiki/Zlatan_IbrahimoviÄ‡">Learn more about IbrahimoviÄ‡</a></div></div>
                      <div class="tab-pane fade rounded" id="v-pills-haaland" role="tabpanel" aria-labelledby="v-pills-haaland-tab" tabindex="0">  <img src="experiment-images/19.jpeg" class="rounded" alt="Loading..." />
                        <div class="video-container">
                          <video autoplay loop muted class="background-video">
                              <source src="videos/haaland.mp4" type="video/mp4">
                              Your browser does not support the video tag.
                          </video>
                      </div>
                      <div class="content-overlay">  
                        <p></p>
                        <p><strong><u>Team:</u></strong> Manchester City F.C.<br><strong><u>National Team:</u></strong> Norway</p>
            
                        <ol>
                        <li>Bryne 2</li>
                        <li>Bryne</li>
                        <li>Molde 2</li>
                        <li>Molde</li>
                        <li>Red Bull Salzburg</li>
                        <li>Borussia Dortmund</li>
                        <li>Manchester City</li>
                        </ol>
            
                        <a target="_blank" href="https://en.wikipedia.org/wiki/Erling_Haaland">Learn more about Haaland</a></div></div>
                      <div class="tab-pane fade rounded" id="v-pills-modriÄ‡" role="tabpanel" aria-labelledby="v-pills-modriÄ‡-tab" tabindex="0">  <img src="experiment-images/21.jpeg" class="rounded" alt="Loading..." />
                        <div class="video-container">
                          <video autoplay loop muted class="background-video">
                              <source src="videos/modric.mp4" type="video/mp4">
                              Your browser does not support the video tag.
                          </video>
                      </div>
                      <div class="content-overlay">
                        <p></p> 
                        <p><strong><u>Team:</u></strong> Real Madrid CF<br><strong><u>National Team:</u></strong> Croatia</p>
            
                        <ol>
                        <li>Dinamo Zagreb</li>
                        <li>Zrinjski Mostar (loan)</li>
                        <li>Inter ZapreÅ¡iÄ‡ (loan)</li>
                        <li>Tottenham Hotspur</li>
                        <li>Real Madrid</li>
                        </ol>
            
                        <a target="_blank" href="https://en.wikipedia.org/wiki/Luka_ModriÄ‡">Learn more about ModriÄ‡</a></div></div>
                        <div class="tab-pane fade rounded" id="v-pills-david" role="tabpanel" aria-labelledby="v-pills-david-tab" tabindex="0">  <img src="experiment-images/23.jpeg" class="rounded" alt="Loading..." />
                          <div class="video-container">
                            <video autoplay loop muted class="background-video">
                                <source src="videos/beckham.mp4" type="video/mp4">
                                Your browser does not support the video tag.
                            </video>
                        </div>
                        <div class="content-overlay">  
                          <p></p> 
                        <p><strong><u>Team:</u></strong> Paris Saint-Germain<br><strong><u>National Team:</u></strong> England</p>
              
                          <ol>
                          <li>Manchester United</li>
                          <li>Preston North End (loan)</li>
                          <li>Real Madrid</li>
                          <li>LA Galaxy</li>
                          <li>AC Milan (loan)</li>
                          <li>Paris Saint-Germain</li>
                          </ol>
              
                          <a target="_blank" href="https://en.wikipedia.org/wiki/David_Beckham">Learn more about David</a></div></div>
                          <div class="tab-pane fade rounded" id="v-pills-heung" role="tabpanel" aria-labelledby="v-pills-heung-tab" tabindex="0">  <img src="experiment-images/24.jpeg" class="rounded" alt="Loading..." />
                            <div class="video-container">
                              <video autoplay loop muted class="background-video">
                                  <source src="videos/heung.mp4" type="video/mp4">
                                  Your browser does not support the video tag.
                              </video>
                          </div>
                          <div class="content-overlay">
                            <p></p>
                          <p><strong><u>Team:</u></strong> Tottenham Hotspur F.C.<br><strong><u>National Team:</u></strong> South Korea</p>
                
                            <ol>
                            <li>Hamburger SV II</li>
                            <li>Hamburger SV</li>
                            <li>Bayer Leverkusen</li>
                            <li>Tottenham Hotspur</li>
                            </ol>
                
                            <a target="_blank" href="https://en.wikipedia.org/wiki/Son_Heung-min">Learn more about Heung</a></div></div>
                            <div class="tab-pane fade rounded" id="v-pills-virgil" role="tabpanel" aria-labelledby="v-pills-virgil-tab" tabindex="0">  <img src="experiment-images/25.jpeg" class="rounded" alt="Loading..." />
                              <div class="video-container">
                                <video autoplay loop muted class="background-video">
                                    <source src="videos/virgil.mp4" type="video/mp4">
                                    Your browser does not support the video tag.
                                </video>
                            </div>
                            <div class="content-overlay">
                              <p></p>
                            <p><strong><u>Team:</u></strong> Liverpool F.C<br><strong><u>National Team:</u></strong> Netherlands</p>
                  
                              <ol>
                              <li>Groningen</li>
                              <li>Celtic</li>
                              <li>Southampton</li>
                              <li>Liverpool</li>
                              </ol>
                  
                              <a target="_blank" href="https://en.wikipedia.org/wiki/Virgil_van_Dijk">Learn more about Virgil</a></div></div>
              </div>
          </div>
          <script>
            document.addEventListener('DOMContentLoaded', function() {
                // Intersection Observer for pills animation
                const pills = document.getElementById('pills');
                const pillsObserver = new IntersectionObserver((entries, observer) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            pills.style.animation = 'slideLeft 1s ease-in-out'; // Apply slide-left animation to pills
                            observer.unobserve(entry.target);
                        }
                    });
                });
                pillsObserver.observe(pills);
        
                // Intersection Observer for tab content animation
                const tabContent = document.getElementById('v-pills-tabContent');
                const tabObserver = new IntersectionObserver((entries, observer) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            tabContent.style.animation = 'slideLeft 1s ease-in-out'; // Apply slide-left animation to tab content
                            observer.unobserve(entry.target);
                        }
                    });
                });
                tabObserver.observe(tabContent);
        
                // Intersection Observer for video playback in tab panes
                const tabPanes = document.querySelectorAll('.tab-pane');
                const videoObserver = new IntersectionObserver((entries, observer) => {
                    entries.forEach(entry => {
                        const video = entry.target.querySelector('video');
                        if (entry.isIntersecting) {
                            if (entry.target.classList.contains('active')) {
                                video.play(); // Start video playback if tab pane is active and visible
                            }
                        } else {
                            video.pause(); // Pause video if tab pane is not visible
                        }
                    });
                }, { threshold: 0.5 }); // Adjust threshold as needed
        
                // Observe all tab panes for video playback control
                tabPanes.forEach(tabPane => {
                    videoObserver.observe(tabPane);
                });
        
                // Bootstrap Tabs initialization
                var triggerTabList = [].slice.call(document.querySelectorAll('#v-pills'))
                triggerTabList.forEach(function(triggerEl) {
                    var tabTrigger = new bootstrap.Tab(triggerEl)
        
                    triggerEl.addEventListener('click', function(event) {
                        event.preventDefault()
                        tabTrigger.show()
                    })
                });
            });
        </script>
      <br><br>
      <header class="text-center border-bottom py-3">
      <h3>Statistics of the players</h3>
      </header>
      <style>
    /* CSS for the animated rows */
    @keyframes fadeInAnimation {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    tr {
      opacity: 0;
    }

    .fade-in {
      animation: fadeInAnimation 2s ease-in-out forwards;
    }

    #table {
  background-color: rgba(0, 0, 0, 0.4); /* Semi-transparent background color */
}

/* Ensure table header is transparent */
#table thead {
  background-color: rgba(0, 0, 0, 0.4); /* Adjust transparency as needed */
}

/* Ensure table cells are transparent */
#table td, #table th {
  background-color: rgba(0, 0, 0, 0.4); /* Adjust transparency as needed */
}

#table tbody tr:hover,
#table tbody tr.touched {
  background-color: rgba(110, 110, 110, 0.685); /* Semi-transparent background on hover or touch */
}
      </style>
      <table class="table table-dark" id="table">
      <tr>
      <th>Players</th>
      <th>Played</th>
      <th>Goals</th>
      </tr>
      <tr>
      <td>Messi</td>
      <td>1124</td>
      <td>865</td>
      </tr>
      <tr>
      <td>Ronaldo</td>
      <td>1270</td>
      <td>916</td>
      </tr>
      <tr>
      <td>Neymar</td>
      <td>717</td>
      <td>439</td>
      </tr>
      <tr>
      <td>MbappÃ©</td>
      <td>467</td>
      <td>336</td>
      </tr>
      <tr>
      <td>Salah</td>
      <td>703</td>
      <td>347</td>
      </tr>
      <tr>
      <td>Kane</td>
      <td>645</td>
      <td>407</td>
      </tr>
      <tr>
      <td>SuÃ¡rez</td>
      <td>968</td>
      <td>576</td>
      </tr>
      <tr>
      <td>Ã–zil</td>
      <td>697</td>
      <td>121</td>
      </tr>
      <tr>
      <td>Hakimi</td>
      <td>361</td>
      <td>46</td>
      </tr>
      <tr>
      <td>Griezmann</td>
      <td>830</td>
      <td>313</td>
      </tr>
      <tr>
      <td>Lewandowski</td>
      <td>996</td>
      <td>687</td>
      </tr>
      <tr>
      <td>IbrahimoviÄ‡</td>
      <td>988</td>
      <td>573</td>
      </tr>
      <tr>
      <td>Haaland</td>
      <td>316</td>
      <td>260</td>
      </tr>
      <tr>
      <td>ModriÄ‡</td>
      <td>1048</td>
      <td>126</td>
      </tr>
      <tr>
      <td>David</td>
      <td>834</td>
      <td>146</td>
      </tr>
      <tr>
      <td>Heung</td>
      <td>708</td>
      <td>262</td>
      </tr>
      <tr>
      <td>Virgil</td>
      <td>607</td>
      <td>61</td>
      </tr>
      </table>
      <script>
    document.querySelectorAll('#table tbody tr').forEach(function(element) {
    let isTouched = false; // Track touch state for each element
    element.addEventListener('touchstart', function(event) {
        event.preventDefault(); // Prevents accidental double triggers
        if (!isTouched) {
            this.classList.add('touched');
            isTouched = true;
        } else {
            this.classList.remove('touched');
            isTouched = false;
        }
    });
});

        </script>
      <style>
        @keyframes slideRight {
          from {
            transform: translateX(-100%);
            opacity: 0;
          }
          to {
            transform: translateX(0);
            opacity: 1;
          }
        }
      
        .slide-right {
          animation: slideRight 2s ease forwards;
        }
      
        .alert-success {
          background-color: #4CAF50; /* Green background */
          color: white; /* White text */
          padding: 15px; /* Padding */
          margin-top: 15px; /* Margin */
          border-radius: 5px; /* Rounded corners */
        }
      
        /* Adjustments for smartphones */
        @media only screen and (max-width: 600px) {
          #write-area {
            width: 90%;
            max-width: 300px; /* Adjust as needed */
          }
        }
      
        /* Adjustments for larger screens like monitors */
        @media only screen and (min-width: 601px) {
          #write-area {
            width: 100%;
            max-width: 500px; /* Adjust as needed */
          }
        }


      </style>
      
      <div class="row mb-4">
        <div class="col-md-6">
          <div id="voting-form" class="container">
            <h2>Who's the best?</h2>
            <form id="voting">
              <p>Your Name<br><input class="rounded" type="text" name="name" id="nameInput" /></p>
              <p>Who's your favorite?</p>
              <input list="players" class="rounded" name="my-favorite" id="favoriteInput" placeholder="Search...">
              <datalist id="players">
                <option value="Lionel Messi">
                <option value="Cristiano Ronaldo">
                <option value="Neymar Junior">
                <option value="Kylian MbappÃ©">
                <option value="Mohamed Salah">
                <option value="Harry Kane">
                <option value="Luis SuÃ¡rez">
                <option value="Mesut Ã–zil">
                <option value="Achraf Hakimi">
                <option value="Antoine Griezmann">
                <option value="Robert Lewandowski">
                <option value="Zlatan IbrahimoviÄ‡">
                <option value="Erling Haaland">
                <option value="Luka ModriÄ‡">
                <option value="David Beckham">
                <option value="Son Heung-min">
                <option value="Virgil van Dijk">
              </datalist>
              <p>Why is he your favorite?<br><textarea class="rounded" name="why-favorite" rows="7" cols="29" id="write-area"></textarea></p>
              <button class="rounded" type="submit" id="submitBtn">Submit</button>
            </form>
          </div>
                  <style>
   @keyframes slideLeft {
    from {
      transform: translateX(-100%);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }

  .slide-left {
    animation: slideLeft 2s ease forwards;
  }

  #login-card{
   background-color: rgba(0, 0, 0, 0.4);
  }
    
    /* Semi-transparent on hover (PC) */
    #login-card:hover {
        background-color: rgba(110, 110, 110, 0.685);
    }
    
    /* Semi-transparent when touched (Smartphones) */
    #login-card.touched {
        background-color: rgba(110, 110, 110, 0.685); /* Semi-transparent background */
    }
</style>
          <div id="login-card" class="card text-center shadow p-4 my-5 rounded-3" style="display:none;">
          <div class="featured-image">
                <img src="experiment-images/favicon.jpg" class="img-fluid rounded" alt="Loading..." style="width: 54%; height: 54%; object-fit: cover;">
        </div>
    <h4 class="card-title">ðŸ”’ Login Required</h4>
  <p class="card-text">You must login to access the voting form and enjoy an ad-free experience.</p>
  <a href="experiment-login.html" class="btn btn-success">Login</a>
  <a href="experiment-signup.html" class="btn btn-primary">Sign Up</a>
</div>
<script>
document.addEventListener("DOMContentLoaded", function () {
  // Touch effect
  document.querySelectorAll('#login-card').forEach(function(element) {
    let isTouched = false; // Track touch state for each element
    element.addEventListener('touchstart', function(event) {
      event.preventDefault(); // Prevents accidental double triggers
      if (!isTouched) {
        this.classList.add('touched');
        isTouched = true;
      } else {
        this.classList.remove('touched');
        isTouched = false;
      }
    });
  });

  // Intersection Observer to detect when login card becomes visible
  const loginObserver = new IntersectionObserver((entries, observer) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        // When login card becomes visible, add a class to trigger animation
        entry.target.classList.add('slide-left');
        observer.unobserve(entry.target);
      }
    });
  });

  // Observe the login card element
  const loginCard = document.querySelector('#login-card');
  if (loginCard) {
    loginObserver.observe(loginCard);
  }
});
</script>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const userEmail = localStorage.getItem("userEmail");
  if (userEmail) {
    const userName = userEmail.split("@")[0];
    document.getElementById('nameInput').value = userName;
  }

  const logoutLink = document.getElementById('logout-link');
  if (logoutLink) {
    logoutLink.addEventListener('click', function() {
      document.getElementById('nameInput').value = '';
      localStorage.removeItem('userEmail');
    });
  }

  const formObserver = new IntersectionObserver((entries, observer) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('slide-right');
        observer.unobserve(entry.target);
      }
    });
  });

  const formSection = document.getElementById('voting-form');
  if (formSection) {
    formObserver.observe(formSection);
  }

  document.querySelectorAll('#voting input:not([name="name"]), #voting textarea').forEach(function(elem) {
    elem.addEventListener('keydown', function(event) {
      if (event.keyCode === 13) {
        event.preventDefault();
      }
    });
  });

  document.getElementById('nameInput').addEventListener('keydown', function(event) {
    if (event.keyCode === 13) {
      event.preventDefault();
    }
  });
  });

// Voting form submission
$("#voting").submit(async function(event){
    event.preventDefault();

    const nameInput = enhancedSanitize($('#voting-form input[name="name"]').val()).trim();
    const favoriteInput = enhancedSanitize($('#voting-form input[name="my-favorite"]').val()).trim();
    const whyFavorite = enhancedSanitize($('#voting-form textarea[name="why-favorite"]').val()).trim();

    if (!nameInput || !favoriteInput || !whyFavorite) {
        alert('Please fill out all fields.');
        return;
    }

    const user = window.firebaseApp.auth.currentUser;
    if (!user) {
        alert('You must be logged in to vote.');
        return;
    }

    // Document reference MUST be user.uid to satisfy Firestore rules
    const voteDocRef = window.firebaseApp.doc(
        window.firebaseApp.collection(window.firebaseApp.db, "votes"),
        user.uid
    );

    const voteData = {
        favoritePlayer: favoriteInput,
        reason: whyFavorite,
        timestamp: Date.now(),
        userId: user.uid
    };

    try {
        const existing = await window.firebaseApp.getDoc(voteDocRef);

        if (existing.exists()) {
            await window.firebaseApp.updateDoc(voteDocRef, voteData);
        } else {
            await window.firebaseApp.setDoc(voteDocRef, voteData);
        }

        const safeAlert = document.createElement('div');
        safeAlert.className = 'alert alert-success';
        safeAlert.textContent = `Thank you ${nameInput}, for your vote!`;

        document.getElementById('voting-form').textContent = '';
        document.getElementById('voting-form').appendChild(safeAlert);

    } catch (error) {
        console.error("Error saving vote:", error);
        alert("Error saving vote: " + error.message);
    }
});
</script>
      
<style>
   @keyframes slideLeft {
    from {
      transform: translateX(-100%);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }

  .slide-left {
    animation: slideLeft 2s ease forwards;
  }

  .profile-card{
   background-color: rgba(0, 0, 0, 0.4);
  }
    
    /* Semi-transparent on hover (PC) */
    .profile-card:hover {
        background-color: rgba(110, 110, 110, 0.685);
    }
    
    /* Semi-transparent when touched (Smartphones) */
    .profile-card.touched {
        background-color: rgba(110, 110, 110, 0.685); /* Semi-transparent background */
    }
</style>     
<div class="col-md-6">
      <div class="profile-card text-center shadow p-4 my-5 rounded-3">
     <div class="profile-photo shadow">
         <img src="experiment-images/22.jpg" alt="Loading..." class="img-fluid">
     </div>
     <h3 class="pt-3 text" style="color: #fff;">Mahin Haque</h3>
     <p style="color: #fff;">Newbie web developer trying to be pro.<br>Bio : Life without happiness is like useless to live. So, try to enjoy your life.</p>
     <div class="social-links">
         <ul>
             <li style="color: #fff;">Follow me at: <a target="_blank" href="https://www.facebook.com/mahin611"><i class="fa-brands fa-facebook"></i></a></li>
             <li><a target="_blank" href="https://twitter.com/Mahinh6111"><i class="fa-brands fa-x-twitter"></i></a></li>
             <li><a target="_blank" href="https://www.instagram.com/mahinh611"><i class="fa-brands fa-instagram"></i></a></li>
         </ul>
         <ul>
          <li style="color: #fff;">My Blog site: <a target="_blank" href="blog.html"><i class="fa-solid fa-globe"></i></a></li>
         </ul>
                  <ul>
          <li style="color: #fff;">My e-portfolio: <a target="_blank" href="https://sites.google.com/view/mahin-ad/"><i class="fa-solid fa-paperclip"></i></a></li>
         </ul>
         <ul>
         <li style="color: #fff;">Suggestions or bug reports at: <a target="_blank" href="mailto:mahinh611@gmail.com"><i class="fa-solid fa-envelope"></i></a></li>
         </ul>
     </div>
      </div>
     </div>
     </div>
     </div>
     <script>
    document.querySelectorAll('.profile-card').forEach(function(element) {
    let isTouched = false; // Track touch state for each element
    element.addEventListener('touchstart', function(event) {
        event.preventDefault(); // Prevents accidental double triggers
        if (!isTouched) {
            this.classList.add('touched');
            isTouched = true;
        } else {
            this.classList.remove('touched');
            isTouched = false;
        }
    });
}); 
     </script> 
  <style>
    /* Add to your existing CSS */
.chart-container {
    background-color: rgba(255, 255, 255, 0.05);
    border-radius: 10px;
    padding: 15px;
}

#votingChart {
    color: white;
}

   @keyframes slideLeft {
    from {
      transform: translateX(-100%);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }

  .slide-left {
    animation: slideLeft 2s ease forwards;
  }

  #ch{
   background-color: rgba(0, 0, 0, 0.4);
  }
    
    /* Semi-transparent on hover (PC) */
    #ch:hover {
        background-color: rgba(110, 110, 110, 0.685);
    }
    
    /* Semi-transparent when touched (Smartphones) */
    #ch.touched {
        background-color: rgba(110, 110, 110, 0.685); /* Semi-transparent background */
    }

    </style>
     <div class="container mt-5">
    <div class="row">
        <div class="col-12">
            <div class="card shadow p-4 rounded-3" id="ch">
                <h3 class="text-center mb-4">Live Voting Results</h3>
                <div class="chart-container" style="position: relative; height:400px; width:100%">
                    <canvas id="votingChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
  let votingChart = null;

function initializeVotingChart() {
    console.log("Initializing chart...");
    
    const ctx = document.getElementById('votingChart');
    if (!ctx) {
        console.error("Chart canvas not found!");
        return;
    }

    // Destroy existing chart if it exists and is a valid Chart instance
    if (votingChart && typeof votingChart.destroy === 'function') {
        votingChart.destroy();
    }

    votingChart = new Chart(ctx.getContext('2d'), {
        type: 'bar',
        data: {
            labels: ['No votes yet'],
            datasets: [{
                label: 'Number of Votes',
                data: [0],
                backgroundColor: 'rgba(54, 162, 235, 0.6)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    labels: {
                        color: 'white'
                    }
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return `${context.parsed.y} votes`;
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        color: 'white',
                        callback: function(value) {
                            return value;
                        }
                    }
                },
                x: {
                    ticks: {
                        color: 'white'
                    }
                }
            }
        }
    });

    // Listen for votes from Firestore
    if (window.firebaseApp && window.firebaseApp.onSnapshot) {
        const q = window.firebaseApp.query(
            window.firebaseApp.collection(window.firebaseApp.db, "votes")
        );
        
        window.firebaseApp.onSnapshot(q, (snapshot) => {
            const counts = {};
            
            snapshot.docChanges().forEach((change) => {
                const vote = change.doc.data();
                if (vote && vote.favoritePlayer) {
                    const player = vote.favoritePlayer;
                    
                    if (change.type === 'added' || change.type === 'modified') {
                        counts[player] = (counts[player] || 0) + 1;
                    } else if (change.type === 'removed') {
                        counts[player] = (counts[player] || 1) - 1;
                        if (counts[player] <= 0) {
                            delete counts[player];
                        }
                    }
                }
            });

            console.log("Vote counts:", counts);

            // Update chart
            const players = Object.keys(counts);
            const voteCounts = players.map(player => counts[player]);

            if (players.length > 0) {
                votingChart.data.labels = players;
                votingChart.data.datasets[0].data = voteCounts;
                votingChart.data.datasets[0].label = 'Number of Votes';
                votingChart.update();
                
                console.log("Chart updated with:", players, voteCounts);
            } else {
                // Reset chart if no votes
                votingChart.data.labels = ['No votes yet'];
                votingChart.data.datasets[0].data = [0];
                votingChart.update();
            }
        }, (error) => {
            console.error("Firestore error:", error);
        });
    } else {
        console.error("Firebase functions not available for chart");
    }
}

// Make function globally available
window.initializeVotingChart = initializeVotingChart;

// Initialize chart when DOM is ready
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(initializeVotingChart, 2000);
});

document.addEventListener("DOMContentLoaded", function () {
  // Touch effect
  document.querySelectorAll('#ch').forEach(function(element) {
    let isTouched = false; // Track touch state for each element
    element.addEventListener('touchstart', function(event) {
      event.preventDefault(); // Prevents accidental double triggers
      if (!isTouched) {
        this.classList.add('touched');
        isTouched = true;
      } else {
        this.classList.remove('touched');
        isTouched = false;
      }
    });
  });

  // Intersection Observer to detect when ch becomes visible
  const chObserver = new IntersectionObserver((entries, observer) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        // When ch becomes visible, add a class to trigger animation
        entry.target.classList.add('slide-left');
        observer.unobserve(entry.target);
      }
    });
  });

  // Observe the ch element
  const ch = document.querySelector('#ch');
  if (ch) {
    chObserver.observe(ch);
  }
});
  </script>
     <style>
      .footer-animation {
        opacity: 0;
        transform: translateY(20px);
        transition: opacity 3s ease, transform 3s ease;
      }
    
      .footer-animation.animated {
        opacity: 1;
        transform: translateY(0);
      }

footer {
  background-color: rgba(0, 0, 0, 0.4);
  color: #fff;
  text-align: center;
  padding: 10px;
}
   
    /* Semi-transparent on hover (PC) */
    footer:hover {
        background-color: rgba(110, 110, 110, 0.685);
    }
    
    /* Semi-transparent when touched (Smartphones) */
    footer.touched {
        background-color: rgba(110, 110, 110, 0.685); /* Semi-transparent background */
    }
    </style>
    <p><br></p>    
<footer class="text-center footer-animation">
  <div class="container">
    <p class="mb-0">This site is solely written and maintained by Mahin Haque.<br>This site was last updated at 28 November 2025.<br>Website version: 4.5.27/8/24</p>
  </div>
</footer>
      <script>
        document.addEventListener("DOMContentLoaded", function() {
          const footer = document.querySelector("footer");
          
          // Create an Intersection Observer
          const observer = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
              if (entry.isIntersecting) {
                entry.target.classList.add('animated');
                observer.unobserve(entry.target); // Stop observing the element once it has animated
              }
            });
          }, {
            threshold: 0.1 // Trigger animation when 10% of the element is in view
          });
      
          // Observe the footer
          observer.observe(footer);
        });

        document.querySelectorAll('footer').forEach(function(element) {
    let isTouched = false; // Track touch state for each element
    element.addEventListener('touchstart', function(event) {
        event.preventDefault(); // Prevents accidental double triggers
        if (!isTouched) {
            this.classList.add('touched');
            isTouched = true;
        } else {
            this.classList.remove('touched');
            isTouched = false;
        }
    });
});
      
      </script>      

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
    </body>
    <script>
      // Intersection Observer to detect when the table becomes visible
      const table = document.getElementById('table');
      const tableObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            // When the table becomes visible, apply animation to its rows
            const rows = table.querySelectorAll('tr');
            rows.forEach((row, index) => {
              row.classList.add('fade-in');
              row.style.animationDelay = `${index * 0.2}s`; // Adjust delay as needed
            });
            observer.unobserve(entry.target);
          }
        });
      });
      tableObserver.observe(table);
document.addEventListener('DOMContentLoaded', function() {
  // Intersection Observer to detect when profile card becomes visible
  const profileObserver = new IntersectionObserver((entries, observer) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        // When profile card becomes visible, add a class to trigger animation
        entry.target.classList.add('slide-left');
        observer.unobserve(entry.target);
      }
    });
  });

  // Observe the profile card element
  const profileCard = document.querySelector('.profile-card');
  profileObserver.observe(profileCard);
});

</script>

    </html>
